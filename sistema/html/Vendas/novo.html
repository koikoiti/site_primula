<link rel="stylesheet" type="text/css" href="<%URLPADRAO%>html/js/jasny.bootstrap/extend/css/jasny-bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="<%URLPADRAO%>html/js/bootstrap-colorpicker/dist/css/bootstrap-colorpicker.min.css">
<link rel="stylesheet" type="text/css" href="<%URLPADRAO%>html/js/bootstrap.switch/bootstrap-switch.min.css" />
<link rel="stylesheet" type="text/css" href="<%URLPADRAO%>html/js/bootstrap.datetimepicker/css/bootstrap-datetimepicker.min.css" />
<link rel="stylesheet" type="text/css" href="<%URLPADRAO%>html/js/jquery.select2/select2.css" />
<link rel="stylesheet" type="text/css" href="<%URLPADRAO%>html/js/bootstrap.slider/css/slider.css" />
<link rel="stylesheet" type="text/css" href="<%URLPADRAO%>html/js/jquery.icheck/skins/flat/green.css">
<link rel="stylesheet" type="text/css" href="<%URLPADRAO%>html/js/bootstrap.daterangepicker/daterangepicker-bs3.css" />
<div class="header">
    <h3><%TITULO%></h3>
</div>
<div class="content">
    <div class="col-md-12">
    
        <div class="form-group" style="width: 90%; float: left">
            <label class="col-sm-3 control-label form-margin">*Cliente</label>
            <div class="col-sm-6 ui-widget">
                <input type="hidden" value="" id="hid_cliente" name="cliente" />
                <input type="hidden" value="" id="hid_tipoprofissional" name="tipoprofissional" />
                <input id="cliente" autofocus required type="text" class="form-control" value="" onblur="validaCliente(this.value)" autocomplete="off" placeholder="Nome Fantasia, Contato ou CPF/CNPJ"/>
            </div>
        </div>
        
        <div class="form-group" style="width: 10%; float: left">
            <label class="col-sm-3 control-label form-margin">&nbsp;</label>
            <div class="col-sm-6">
                <a href="javascript:void(0)" onclick="javascript: window.open('<%URLPADRAO%>cliente')" class="btn btn-default">Novo</a>
            </div>
        </div>
            
        <div class="form-group">
            <label class="col-sm-3 control-label form-margin">*Produtos</label>
                <div class="col-sm-6">
                    <button onclick="mais()" type="button" class="btn btn-primary">+</button>
                    <div class="form-group" id="lista-produtos">
                    	
                    </div>
            </div>
        </div>
        
        <!--div class="form-group">
            <label class="col-sm-6 control-label" style="margin-top: 10px;">Sub-Total Produtos: </label>
            <div class="col-sm-6">
                <label>R$ <span id="subtotal"></span></label>
            </div>
        </div-->
        
        <div class="form-group form-margin" style="width: 50%; float: left">
            <label class="col-sm-6 control-label">*Frete - <a href="http://www2.correios.com.br/sistemas/precosPrazos/" target="_blank">Correios</a></label>
            <div class="col-sm-6">
                <%SELECTTIPOFRETE%>
            </div>
        </div>
        
        <div class="form-group form-margin" style="width: 25%; float: left">
            <label class="col-sm-6 control-label">*Valor Frete</label>
            <div class="col-sm-6">
                <input required type="text" class="form-control money" name="frete" value=""/>
            </div>
        </div>
        
        <div class="form-group form-margin" style="width: 25%; float: left">
            <label class="col-sm-6 control-label">&nbsp;</label>
            <div class="col-sm-6">
                <label><input type="checkbox" name="por_conta" value="1"/> Frete por conta</label>
            </div>
        </div>
        
        <div class="form-group">
            <div class="col-sm-6 form-margin">
                <button onclick="checkout();" style="box-shadow: none;background-color: #19b698;border-color: transparent;border-color: #CCCCCC;border-radius: 0;-webkit-border-radius: 0;outline: none;margin-bottom: 5px;margin-left: 3px;font-size: 13px;padding: 7px 11px;" type="submit" class="btn btn-success btn-flat">
                    <i class="fa fa-check"></i> Checkout
                </button>
                <button style="box-shadow: none;background-color: rgb(156, 98, 218);border-color: transparent;border-color: #CCCCCC;border-radius: 0;-webkit-border-radius: 0;outline: none;margin-bottom: 5px;margin-left: 3px;font-size: 13px;padding: 7px 11px;" type="submit" class="btn btn-success btn-flat">
                    <i class="fa fa-check"></i> Salvar Orçamento
                </button>
                <%BOTAOVOLTAR%>
                <%BOTAOATIVARINATIVAR%>
                <%BOTAOEXCLUIR%>
           </div>
        </div>
    </div>
</div>
<input type="hidden" name="acao" value="acao" />
<script type="text/javascript">
function validaCliente(val){
    if(val == ''){
        $("#hid_cliente").val('');
        $("#lista-produtos").html('');
    }
}

var novo = 0;
$(function() {
    $('.money').mask("#.##0,00", {reverse: true, maxlength: false});
    
    $("#cliente").autocomplete({
        source: "<%URLPADRAO%>lib/ajax/clienteautocomplete.php",
        minLength: 2,
        select: function(event, ui){
            $('#hid_cliente').val(ui.item.idcliente);
            $('#hid_tipoprofissional').val(ui.item.idtipoprofissional);
        }
    });
});

function mais(){
    var idcliente = $('#hid_cliente').val();
    var idtipoprofissional = $('#hid_tipoprofissional').val();
    var idpreco;
    if(idcliente == ''){
        alert("Selecione um cliente!");
    }else{
        var verifica = document.getElementById('produtonovo'+(novo-1));
        
        if(verifica == null || verifica.value.length > 1){
        	idpreco = novo;
            novadiv = document.createElement('div');
            novadiv.setAttribute('id', 'novo'+novo);
            novadiv.setAttribute('class', 'novo-produto');
            novadiv.innerHTML = "<div class='col-sm-10 no-padding'><div class='col-sm-11 no-padding'><div class='col-md-12' id='div_produto"+novo+"'>Produto: <input id='produtonovo"+novo+"' type='text' class='form-control' /></div><div class='col-md-2'><br/><label>Preço: R$ <span id='preco"+novo+"'></span></label></div><div class='col-md-2'>Quantidade: <input type='text' class='form-control' value='1' name='quantidade[]' /></div><div class='col-md-2'>Desconto R$: <input name='desconto_valor[]' type='text' class='form-control money' value='0'/></div><div class='col-md-2'>Desconto %: <input name='desconto_porcentagem[]' type='text' class='form-control porcentagem' value='0'/></div><div class='col-md-2'><br/><label><input name='brinde[]' type='checkbox'/> Brinde</label></div></div><div class='col-sm-1 no-padding'><div class='col-sm-1'><br/><button onclick='menos("+novo+")' type='button' class='btn btn-danger'>-</button></div></div></div>";
            //novadiv.innerHTML = "<div class='col-md-3' id='div_produto"+novo+"'>Produto: <input id='produtonovo"+novo+"' type='text' class='form-control' /></div><div class='col-md-1'>Quantidade: <input type='text' class='form-control' value='1' name='quantidade[]' /></div><div class='col-md-1'>Desconto Valor: <input name='desconto_valor[]' type='text' class='form-control money' value='0'/></div><div class='col-md-1'>Desconto Porcentagem: <input name='desconto_porcentagem[]' type='text' class='form-control porcentagem' value='0'/></div><div class='col-md-2'><br/><label><input name='brinde[]' type='checkbox'/> Brinde</label></div><div class='col-sm-1'><br/><button onclick='menos("+novo+")' type='button' class='btn btn-danger'>-</button></div>";
            document.getElementById('lista-produtos').appendChild(novadiv);
            $('.money').mask("#.##0,00", {reverse: true, maxlength: false});
            $('.porcentagem').mask("00,00", {reverse: true,});
            
            $("#produtonovo"+novo).autocomplete({
                source: function(request, response) {
                            $.getJSON("<%URLPADRAO%>lib/ajax/produtoautocomplete.php", {term: request.term, idtipoprofissional: idtipoprofissional}, 
                        response);
                        },
                minLength: 2,
                select: function(event, ui){
                    //<input type='hidden' name='produtos[]' value='' id='hid_produtonovo"+novo+"' />
                    var hid_produto = document.getElementById("hid_produto"+novo);
                    if(hid_produto != null){
                        hid_produto.remove();
                    }else{
                        var imgOld = document.getElementById('outer'+novo);
                        if(imgOld != null){
                            imgOld.remove();
                        }
                        var hid_produto = document.createElement('input');
                        hid_produto.setAttribute('type', 'hidden');
                        hid_produto.setAttribute('name', 'produtos[]');
                        hid_produto.setAttribute('id', 'hid_produtonovo'+novo);
                        hid_produto.setAttribute('value', ui.item.idproduto);
                        var img = document.createElement('img');
                        var outerimg = document.createElement('div');
                        outerimg.setAttribute('id', 'outer'+novo);
                        outerimg.setAttribute('class', 'col-md-2 text-center');
                        outerimg.appendChild(img);
                        img.setAttribute('id', 'img'+novo);
                        img.setAttribute('src', ui.item.caminho);
                        img.setAttribute('style', 'width: 100px; height: 100px;');
                        var i = colocaPreco(idpreco, ui.item.valor);
                        if(i){
	                        $(novadiv).prepend(outerimg);
	                        novadiv.appendChild(hid_produto);
	                        $('.money').mask("#.##0,00", {reverse: true, maxlength: false});
                        }
                    }
                }
            });
            novo++;   
        }
    }
}

function colocaPreco(id, valor){
	console.log(id + " " + valor);
	$("#preco"+id).html(valor);
	return true;
}

function menos(idnovo){
    document.getElementById('novo'+idnovo).remove();
}

function voltar(){
    location.href = "<%URLPADRAO%>lista-venda";
}

function checkout(){
    $('form').attr('action', 'pre-checkout');
}
</script>
    <script type="text/javascript" src="<%URLPADRAO%>html/js/jasny.bootstrap/extend/js/jasny-bootstrap.min.js"></script>
    <script type="text/javascript" src="<%URLPADRAO%>html/js/bootstrap.daterangepicker/moment.min.js"></script>
    <script type="text/javascript" src="<%URLPADRAO%>html/js/bootstrap.daterangepicker/daterangepicker.js"></script>
    <script type="text/javascript" src="<%URLPADRAO%>html/js/bootstrap.touchspin/bootstrap-touchspin/bootstrap.touchspin.js"></script>
    <script type="text/javascript" src="<%URLPADRAO%>html/js/bootstrap-colorpicker/dist/js/bootstrap-colorpicker.js"></script>
    <script type="text/javascript" src="<%URLPADRAO%>html/js/bootstrap.switch/bootstrap-switch.js"></script>
    <script type="text/javascript" src="<%URLPADRAO%>html/js/bootstrap.datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
    <script type="text/javascript" src="<%URLPADRAO%>html/js/jquery.select2/select2.min.js"></script>
    <script type="text/javascript" src="<%URLPADRAO%>html/js/bootstrap.slider/js/bootstrap-slider.js"></script>
    <script type="text/javascript" src="<%URLPADRAO%>html/js/jquery.icheck/icheck.min.js"></script>
<style>
.ui-autocomplete-loading {
    background: white url("<%URLPADRAO%>html/images/loading.gif") right center no-repeat;
}
</style>