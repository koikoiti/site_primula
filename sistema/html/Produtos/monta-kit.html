<link rel="stylesheet" type="text/css" href="<%URLPADRAO%>html/js/jasny.bootstrap/extend/css/jasny-bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="<%URLPADRAO%>html/js/bootstrap-colorpicker/dist/css/bootstrap-colorpicker.min.css">
<link rel="stylesheet" type="text/css" href="<%URLPADRAO%>html/js/bootstrap.switch/bootstrap-switch.min.css" />
<link rel="stylesheet" type="text/css" href="<%URLPADRAO%>html/js/bootstrap.datetimepicker/css/bootstrap-datetimepicker.min.css" />
<link rel="stylesheet" type="text/css" href="<%URLPADRAO%>html/js/jquery.select2/select2.css" />
<link rel="stylesheet" type="text/css" href="<%URLPADRAO%>html/js/bootstrap.slider/css/slider.css" />
<link rel="stylesheet" type="text/css" href="<%URLPADRAO%>html/js/jquery.icheck/skins/flat/green.css">
<link rel="stylesheet" type="text/css" href="<%URLPADRAO%>html/js/bootstrap.daterangepicker/daterangepicker-bs3.css" />
<div class="header">
    <h3><%TITULO%></h3>
</div>
<div class="content">
    <div class="col-md-12">
        
        <div class="form-group" style="float: left; width: 50%">
            <label class="col-sm-3 control-label form-margin">*Nome do Kit</label>
            <div class="col-sm-6">
                <input autofocus required type="text" class="form-control" name="nome" value="<%NOME%>">
            </div>
        </div>
        <div class="form-group" style="float: left; width: 50%">
            <label class="col-sm-3 control-label form-margin">*Marca</label>
            <div class="col-sm-6">
                <input required type="text" class="form-control" name="marca" value="<%MARCA%>">
            </div>
        </div>
        
        <div class="form-group" style="float: left; width: 50%">
            <label class="col-sm-3 control-label form-margin">*Código</label>
            <div class="col-sm-6">
                <input required type="text" class="form-control" name="codigo" value="<%CODIGO%>">
            </div>
        </div>
        <div class="form-group" style="float: left; width: 50%">
            <label class="col-sm-3 control-label form-margin">*Código Fornecedor</label>
            <div class="col-sm-6">
                <input required type="text" class="form-control" name="codigo_fornecedor" value="<%CODIGOFORNECEDOR%>">
            </div>
        </div>
        
        <div class="form-group">
            <label class="col-sm-3 control-label form-margin">*Custo</label>
            <div class="col-sm-6">
                <input required type="text" class="form-control money" name="valor" value="<%VALOR%>">
            </div>
        </div>
        
        <div class="form-group" style="float: left; width: 33.33%">
            <label class="col-sm-3 control-label form-margin">Valor Profissional</label>
            <div class="col-sm-6">
                <input type="text" class="form-control money" name="valor_profissional" value="<%VALORPROFISSIONAL%>">
            </div>
        </div>
        <div class="form-group" style="float: left; width: 33.33%">
            <label class="col-sm-3 control-label form-margin">Valor Consumidor</label>
            <div class="col-sm-6">
                <input type="text" class="form-control money" name="valor_consumidor" value="<%VALORCONSUMIDOR%>">
            </div>
        </div>
        <div class="form-group" style="float: left; width: 33.33%">
            <label class="col-sm-3 control-label form-margin">Estoque</label>
            <div class="col-sm-6">
                <input type="number" class="form-control" name="estoque" value="<%ESTOQUE%>">
            </div>
        </div>
        
        <div class="form-group">
            <label class="col-sm-3 control-label form-margin">*Produtos</label>
                <div class="col-sm-6">
                    <button onclick="mais()" type="button" class="btn btn-primary">+</button>
                    <div class="form-group" id="lista-produtos">
                        <%PRODUTOS%>
                    </div>
            </div>
        </div>
        
        <div class="form-group">
            <label class="col-sm-3 control-label form-margin">*Descrição (Site)</label>
            <div class="col-sm-6">
                <textarea class="form-control" name="descricao"><%DESCRICAO%></textarea>
            </div>
        </div>
        
        <div class="form-group">
            <label class="col-sm-3 control-label form-margin">Informações (Interno)</label>
            <div class="col-sm-6">
                <textarea class="form-control" name="informacoes"><%INFORMACOES%></textarea>
            </div>
        </div>
        
        <div class="col-md-6" style="width: 100%;">
            <div class="form-group">
                <div class="col-sm-3" style="width: 100%;">
                    <input id="files" <%REQUIREFOTO%> name="imagens[]" multiple type="file" class="filestyle" data-buttonText="Selecionar Imagens" data-input="false" accept="image/png, image/jpg, image/gif, image/jpeg" data-badge="false"/>
                </div>
            </div>
            <div id="sortable" class="sectionFoto group"><%IMAGENS%></div>
          <div class="form-group">
                <div class="col-sm-6 form-margin">
                    <input type="hidden" name="imgOrder" id="imgOrder" value="<%HIDDEN%>" />
                    <button onclick="return verificaFotos()" style="box-shadow: none;background-color: #19b698;border-color: transparent;border-color: #CCCCCC;border-radius: 0;-webkit-border-radius: 0;outline: none;margin-bottom: 5px;margin-left: 3px;font-size: 13px;padding: 7px 11px;" type="submit" class="btn btn-success btn-flat">
                        <i class="fa fa-check"></i> Salvar
                    </button>
                    <%BOTAOVOLTAR%>
                    <%BOTAOATIVARINATIVAR%>
                    <%BOTAOEXCLUIR%>
               </div>
           </div>
        </div>
    </div>
</div>
<input type="hidden" name="acao" value="acao" />
<script type="text/javascript">
$(function() {
    $('.money').mask("#.##0,00", {reverse: true, maxlength: false});
});
</script>
<script type="text/javascript">
var novo = 0;

function voltar(){
    location.href = "<%URLPADRAO%>lista-kit";
}

function ativar(idkit){
    location.href = "<%URLPADRAO%>monta-kit/ativar/" + idkit;
}

function inativar(idkit){
    location.href = "<%URLPADRAO%>monta-kit/inativar/" + idkit;
}
    
function mais(){
    var verifica = document.getElementById('produtonovo'+(novo-1));
    
    if(verifica == null || verifica.value.length > 1){
        novadiv = document.createElement('div');
        novadiv.setAttribute('id', 'novo'+novo);
        novadiv.setAttribute('class', 'novo-produto');
        novadiv.innerHTML = "<div class='col-md-3' id='div_produto"+novo+"'>*Produto: <input required id='produtonovo"+novo+"' type='text' class='form-control' /></div><div class='col-md-1'>*Quantidade: <input required type='number' class='form-control' name='quantidade[]' value='1' /></div><div class='col-sm-1'><br/><button onclick='menos("+novo+")' type='button' class='btn btn-danger'>-</button></div>";
        document.getElementById('lista-produtos').appendChild(novadiv);
        
        $("#produtonovo"+novo).autocomplete({
            source: function(request, response) {
                        $.getJSON("<%URLPADRAO%>lib/ajax/produtoKITautocomplete.php", {term: request.term, idcliente: 0}, 
                    response);
                    },
            minLength: 2,
            select: function(event, ui){
                var hid_produto = document.getElementById("hid_produto"+novo);
                if(hid_produto != null){
                    hid_produto.remove();
                }else{
                    var imgOld = document.getElementById('img'+novo);
                    if(imgOld != null){
                        imgOld.remove();
                    }
                    var hid_produto = document.createElement('input');
                    hid_produto.setAttribute('type', 'hidden');
                    hid_produto.setAttribute('name', 'produtos[]');
                    hid_produto.setAttribute('id', 'hid_produtonovo'+novo);
                    hid_produto.setAttribute('value', ui.item.idproduto);
                    var img = document.createElement('img');
                    img.setAttribute('id', 'img'+novo);
                    img.setAttribute('src', ui.item.caminho);
                    img.setAttribute('style', 'width: 100px; height: 100px;');
                    $(novadiv).prepend(img);
                    novadiv.appendChild(hid_produto);
                }
            }
        });
        novo++;
    }
}

function menos(idnovo, aux){
    if(aux){
        document.getElementById(aux+idnovo).remove();
    }else{
        document.getElementById('novo'+idnovo).remove();
    }
}
</script>
<script type="text/javascript">
/* Multifiles */
var selDiv = "";
var storedFiles = [];

$(document).ready(function() {
	$("#files").on("change", handleFileSelect);
	
	selDiv = $("#sortable"); 
	//$("#myForm").on("submit", handleForm);
	
	$("body").on("click", ".upRemove", removeFile);
});

function handleFileSelect(e) {
	var files = e.target.files;
	var filesArr = Array.prototype.slice.call(files);
	filesArr.forEach(function(f) {			
		if(!f.type.match("image.*")) {
			return;
		}
        
		storedFiles.push(f);
        
		var reader = new FileReader();
		reader.onload = function (e) {
            var html = "<div id='i="+f.name+"' class='colFoto span_1_of_5'><div style='height: 12.6em;'><img class='img-responsive' style='max-height: 100%;display: block; margin-left: auto; margin-right: auto;' src=\"" + e.target.result + "\" data-file='"+f.name+"'/></div><button type='button' style='width: 100%; padding: 1px; margin: 1px 0;' class='btn btn-danger upRemove'>Remover</button></div>";
			selDiv.append(html);
			var sorted = $('#sortable').sortable( "serialize", { expression: (/(.+)[=](.+)/) } );
			$("#imgOrder").val(sorted);
		}
		reader.readAsDataURL(f);
	});	
}

function removeFile(e) {
	var file = $(this).data("file");
	for(var i=0;i<storedFiles.length;i++) {
		if(storedFiles[i].name === file) {
			storedFiles.splice(i,1);
			break;
		}
	}
	$(this).parent().remove();
	var sorted = $('#sortable').sortable( "serialize", { expression: (/(.+)[=](.+)/) } );
	$("#imgOrder").val(sorted);
}

function verificaFotos(){
   var hidden = $("#imgOrder").val();
	if(hidden.length < 1){
		alert("É necessário pelo menos uma foto!!");
		return false;
	}else{
		return true;
	}
}

function removeFotoKit(idimagem, idkit){
    if(confirm("Deseja remover a imagem desse kit?")){
        $.post("<%URLPADRAO%>lib/ajax/removeFotoKit.php",
			{idimagem:idimagem, idkit:idkit},
			function(retorno){
			    if(retorno == 1){
			        //console.log(retorno);
					var element = document.getElementById("i=%"+idimagem);
					element.parentNode.removeChild(element);
					var sorted = $('#sortable').sortable( "serialize", { expression: (/(.+)[=](.+)/) } );
					$("#imgOrder").val(sorted);
				}else if(retorno == 9){
					alert('Ocorreu um erro com o banco de dados. Tente novamente.');
				}
			}
		);
    }
}

$(function(){
	$("#sortable").sortable({scroll: false});
	$("#sortable").disableSelection();
	$("#sortable").sortable({
		stop: function(e, ui){
			var sorted = $('#sortable').sortable( "serialize", { expression: (/(.+)[=](.+)/) } );
			$("#imgOrder").val(sorted);
		}
	});
});
</script>
    <script type="text/javascript" src="<%URLPADRAO%>html/js/jasny.bootstrap/extend/js/jasny-bootstrap.min.js"></script>
    <script type="text/javascript" src="<%URLPADRAO%>html/js/bootstrap.daterangepicker/moment.min.js"></script>
    <script type="text/javascript" src="<%URLPADRAO%>html/js/bootstrap.daterangepicker/daterangepicker.js"></script>
    <script type="text/javascript" src="<%URLPADRAO%>html/js/bootstrap.touchspin/bootstrap-touchspin/bootstrap.touchspin.js"></script>
    <script type="text/javascript" src="<%URLPADRAO%>html/js/bootstrap-colorpicker/dist/js/bootstrap-colorpicker.js"></script>
    <script type="text/javascript" src="<%URLPADRAO%>html/js/bootstrap.switch/bootstrap-switch.js"></script>
    <script type="text/javascript" src="<%URLPADRAO%>html/js/bootstrap.datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
    <script type="text/javascript" src="<%URLPADRAO%>html/js/jquery.select2/select2.min.js"></script>
    <script type="text/javascript" src="<%URLPADRAO%>html/js/bootstrap.slider/js/bootstrap-slider.js"></script>
    <script type="text/javascript" src="<%URLPADRAO%>html/js/jquery.icheck/icheck.min.js"></script>
<style>
/*  SECTIONS  */
.sectionFoto {
	clear: both;
	padding: 0px;
	margin: 10px 0 0 0;
}

/*  COLUMN SETUP  */
.colFoto {
	display: block;
	float:left;
	margin: 0 0 1% 1.2%;
	padding: 3px;
	border-radius: 5px;
	border: 1px solid black;
	background: rgb(240, 240, 233);
	height: 15em;
}
.colFoto:first-child { margin-left: 1.2%; }

/*  GROUPING  */
.group:before,
.group:after { content:""; display:table; }
.group:after { clear:both;}
.group { zoom:1; /* For IE 6/7 */ }
/*  GRID OF FIVE  */
.span_5_of_5 {
	width: 100%;
}
.span_4_of_5 {
	width: 79.68%;
}
.span_3_of_5 {
	width: 59.36%;
}
.span_2_of_5 {
	width: 39.04%;
}
.span_1_of_5 {
	width: 18.72%;
	position: relative;
	display: inline-block;
	margin-bottom: 2em;
}
/*.span_1_of_5:after {
    content: '';
    display: block;
    margin-top: 75%;
}*/


/*  GO FULL WIDTH BELOW 480 PIXELS */
@media only screen and (max-width: 480px) {
	.colFoto { margin: 1% 0 1% 0%; background: rgb(240, 240, 233); }
	.span_1_of_5, .span_2_of_5, .span_3_of_5, .span_4_of_5, .span_5_of_5 { width: 100%; }
	.colFoto:first-child { margin-left: 0; }
}
</style>